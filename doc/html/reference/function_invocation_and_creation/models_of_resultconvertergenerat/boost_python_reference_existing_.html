<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>boost/python/reference_existing_object.hpp</title>
<link rel="stylesheet" href="../../../boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="Boost.Python Reference Manual">
<link rel="up" href="../models_of_resultconvertergenerat.html" title="Models of ResultConverterGenerator">
<link rel="prev" href="boost_python_manage_new_object_h.html" title="boost/python/manage_new_object.hpp">
<link rel="next" href="boost_python_return_by_value_hpp.html" title="boost/python/return_by_value.hpp">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../images/boost.png"></td>
<td align="center"><a href="../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="boost_python_manage_new_object_h.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../models_of_resultconvertergenerat.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="boost_python_return_by_value_hpp.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_"></a><a class="link" href="boost_python_reference_existing_.html" title="boost/python/reference_existing_object.hpp">boost/python/reference_existing_object.hpp</a>
</h3></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object">Class
          <code class="computeroutput"><span class="identifier">reference_existing_object</span></code></a></span></dt>
<dt><span class="section"><a href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object_">Class
          <code class="computeroutput"><span class="identifier">reference_existing_object</span></code>
          metafunctions</a></span></dt>
<dt><span class="section"><a href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.example">Example</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object"></a><a class="link" href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object" title="Class reference_existing_object">Class
          <code class="computeroutput"><span class="identifier">reference_existing_object</span></code></a>
</h4></div></div></div>
<p>
            <code class="computeroutput"><span class="identifier">reference_existing_object</span></code>
            is a model of <a class="link" href="../../concepts/resultconverter/resultconvertergenerator_concept.html" title="ResultConverterGenerator Concept Requirements">ResultConverterGenerator</a>
            which can be used to wrap C++ functions which return a reference or pointer
            to a C++ object. When the wrapped function is called, the value referenced
            by its return value is not copied. A new Python object is created which
            contains a pointer to the referent, and no attempt is made to ensure
            that the lifetime of the referent is at least as long as that of the
            corresponding Python object. Thus, it can be <span class="bold"><strong>highly
            dangerous</strong></span> to use <code class="computeroutput"><span class="identifier">reference_existing_object</span></code>
            without additional lifetime management from such models of <a class="link" href="../../concepts.html#concepts.callpolicies" title="CallPolicies">CallPolicies</a>
            as <a class="link" href="../models_of_callpolicies/boost_python_with_custodian_and_.html#function_invocation_and_creation.models_of_callpolicies.boost_python_with_custodian_and_.class_with_custodian_and_ward" title="Class with_custodian_and_ward"><code class="computeroutput"><span class="identifier">with_custodian_and_ward</span></code></a>. This
            class is used in the implementation of <a class="link" href="../models_of_callpolicies/boost_python_return_internal_ref.html#function_invocation_and_creation.models_of_callpolicies.boost_python_return_internal_ref.class_template_return_internal_r" title="Class template return_internal_reference"><code class="computeroutput"><span class="identifier">return_internal_reference</span></code></a>.
          </p>
<pre class="programlisting"><span class="keyword">namespace</span> <span class="identifier">boost</span> <span class="special">{</span> <span class="keyword">namespace</span> <span class="identifier">python</span>
<span class="special">{</span>
    <span class="keyword">struct</span> <span class="identifier">reference_existing_object</span>
    <span class="special">{</span>
        <span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span> <span class="keyword">struct</span> <span class="identifier">apply</span><span class="special">;</span>
    <span class="special">};</span>
<span class="special">}}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object_"></a><a class="link" href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.class_reference_existing_object_" title="Class reference_existing_object metafunctions">Class
          <code class="computeroutput"><span class="identifier">reference_existing_object</span></code>
          metafunctions</a>
</h4></div></div></div>
<pre class="programlisting"><span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">class</span> <span class="identifier">T</span><span class="special">&gt;</span> <span class="keyword">struct</span> <span class="identifier">apply</span></pre>
<div class="variablelist">
<p class="title"><b></b></p>
<dl class="variablelist">
<dt><span class="term">Requires</span></dt>
<dd><p>
                  <code class="computeroutput"><span class="identifier">T</span></code> is <code class="computeroutput"><span class="identifier">U</span><span class="special">&amp;</span></code>
                  or <code class="computeroutput"><span class="identifier">U</span><span class="special">*</span></code>
                  for some <code class="computeroutput"><span class="identifier">U</span></code>.
                </p></dd>
<dt><span class="term">Returns</span></dt>
<dd><p>
                  <code class="computeroutput"><span class="keyword">typedef</span> <span class="identifier">to_python_indirect</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">,</span> <span class="identifier">V</span><span class="special">&gt;</span> <span class="identifier">type</span><span class="special">;</span></code>, where V is a class whose static
                  execute function constructs an instance holder containing an unowned
                  <code class="computeroutput"><span class="identifier">U</span><span class="special">*</span></code>
                  pointing to the referent of the wrapped function's return value.
                </p></dd>
</dl>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.example"></a><a class="link" href="boost_python_reference_existing_.html#function_invocation_and_creation.models_of_resultconvertergenerat.boost_python_reference_existing_.example" title="Example">Example</a>
</h4></div></div></div>
<p>
            In C++:
          </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">python</span><span class="special">/</span><span class="identifier">module</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">python</span><span class="special">/</span><span class="keyword">class</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">python</span><span class="special">/</span><span class="identifier">reference_existing_object</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">python</span><span class="special">/</span><span class="identifier">return_value_policy</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">utility</span><span class="special">&gt;</span>

<span class="comment">// classes to wrap</span>
<span class="keyword">struct</span> <span class="identifier">Singleton</span>
<span class="special">{</span>
   <span class="identifier">Singleton</span><span class="special">()</span> <span class="special">:</span> <span class="identifier">x</span><span class="special">(</span><span class="number">0</span><span class="special">)</span> <span class="special">{}</span>

   <span class="keyword">int</span> <span class="identifier">exchange</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">n</span><span class="special">)</span>  <span class="comment">// set x and return the old value</span>
   <span class="special">{</span>
        <span class="identifier">std</span><span class="special">::</span><span class="identifier">swap</span><span class="special">(</span><span class="identifier">n</span><span class="special">,</span> <span class="identifier">x</span><span class="special">);</span>
        <span class="keyword">return</span> <span class="identifier">n</span><span class="special">;</span>
   <span class="special">}</span>

   <span class="keyword">int</span> <span class="identifier">x</span><span class="special">;</span>
<span class="special">};</span>

<span class="identifier">Singleton</span><span class="special">&amp;</span> <span class="identifier">get_it</span><span class="special">()</span>
<span class="special">{</span>
   <span class="keyword">static</span> <span class="identifier">Singleton</span> <span class="identifier">just_one</span><span class="special">;</span>
   <span class="keyword">return</span> <span class="identifier">just_one</span><span class="special">;</span>
<span class="special">}</span>

<span class="comment">// Wrapper code</span>
<span class="keyword">using</span> <span class="keyword">namespace</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">python</span><span class="special">;</span>
<span class="identifier">BOOST_PYTHON_MODULE</span><span class="special">(</span><span class="identifier">singleton</span><span class="special">)</span>
<span class="special">{</span>
    <span class="identifier">def</span><span class="special">(</span><span class="string">"get_it"</span><span class="special">,</span> <span class="identifier">get_it</span><span class="special">,</span>
        <span class="identifier">return_value_policy</span><span class="special">&lt;</span><span class="identifier">reference_existing_object</span><span class="special">&gt;());</span>

    <span class="identifier">class_</span><span class="special">&lt;</span><span class="identifier">Singleton</span><span class="special">&gt;(</span><span class="string">"Singleton"</span><span class="special">)</span>
       <span class="special">.</span><span class="identifier">def</span><span class="special">(</span><span class="string">"exchange"</span><span class="special">,</span> <span class="special">&amp;</span><span class="identifier">Singleton</span><span class="special">::</span><span class="identifier">exchange</span><span class="special">)</span>
       <span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
            Python code:
          </p>
<pre class="programlisting"><span class="special">&gt;&gt;&gt;</span> <span class="identifier">import</span> <span class="identifier">singleton</span>
<span class="special">&gt;&gt;&gt;</span> <span class="identifier">s1</span> <span class="special">=</span> <span class="identifier">singleton</span><span class="special">.</span><span class="identifier">get_it</span><span class="special">()</span>
<span class="special">&gt;&gt;&gt;</span> <span class="identifier">s2</span> <span class="special">=</span> <span class="identifier">singleton</span><span class="special">.</span><span class="identifier">get_it</span><span class="special">()</span>
<span class="special">&gt;&gt;&gt;</span> <span class="identifier">id</span><span class="special">(</span><span class="identifier">s1</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">id</span><span class="special">(</span><span class="identifier">s2</span><span class="special">)</span>  <span class="special">#</span> <span class="identifier">s1</span> <span class="keyword">and</span> <span class="identifier">s2</span> <span class="identifier">are</span> <span class="keyword">not</span> <span class="identifier">the</span> <span class="identifier">same</span> <span class="identifier">object</span>
<span class="number">0</span>
<span class="special">&gt;&gt;&gt;</span> <span class="identifier">s1</span><span class="special">.</span><span class="identifier">exchange</span><span class="special">(</span><span class="number">42</span><span class="special">)</span>   <span class="special">#</span> <span class="identifier">but</span> <span class="identifier">they</span> <span class="identifier">reference</span> <span class="identifier">the</span> <span class="identifier">same</span> <span class="identifier">C</span><span class="special">++</span> <span class="identifier">Singleton</span>
<span class="number">0</span>
<span class="special">&gt;&gt;&gt;</span> <span class="identifier">s2</span><span class="special">.</span><span class="identifier">exchange</span><span class="special">(</span><span class="number">99</span><span class="special">)</span>
<span class="number">42</span>
</pre>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2002-2005, 2015 David Abrahams, Stefan Seefeld<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="boost_python_manage_new_object_h.html"><img src="../../../images/prev.png" alt="Prev"></a><a accesskey="u" href="../models_of_resultconvertergenerat.html"><img src="../../../images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../images/home.png" alt="Home"></a><a accesskey="n" href="boost_python_return_by_value_hpp.html"><img src="../../../images/next.png" alt="Next"></a>
</div>
</body>
</html>
